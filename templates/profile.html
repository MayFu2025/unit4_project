{% extends "navbar.html" %}

{% block title %}{{ username }}'s Profile{% endblock %}

{% block content %}
    {% if is_self != True %}
        <h3>{{ user[1] }}</h3>
        <div class="card w-max-90p"> <!-- Profile Section -->
            <div class="card__container">
                <div class="card_image">
                    {% if user[3] != None %}  <!--TODO: thinks aaa has a pfp-->
                        <img src="/uploads/{{ user[3] }}" alt="{{ user[1] }}'s Profile Picture">
                    {% else %}
                        <img src="/default_pfp.png" alt="Default Profile Picture">
                    {% endif %}
                </div>
                <div class="card__action-bar">
                    <a href="{{ url_for('follow_user', user_id=user[0]) }}"><button>{% if user[0] in following_u[0] %}Unfollow{% else %}Follow{% endif %}</button></a>
                </div>

            </div>
        </div>

    {% else %}
    <div> <!-- Profile Section -->
        <h2>My Profile</h2>
        <div> <!-- Image on the right -->
            {% if user[3] != None %}
                <img src="/uploads/{{ user[3] }}" alt="Profile Picture">
            {% else %}
                <img src="/default_pfp.png" alt="Default Profile Picture">
            {% endif %}
        </div>

        <form method="POST" enctype="multipart/form-data">
            <label for="pfp">New Profile Picture:</label>
                <input type="file" id="pfp" name="pfp" accept="image/*">
            <input type="submit" value="Upload">
        </form>

        <div> <!-- Profile Info on the left -->
            <p>Username: {{ user[1] }}</p>
            <p>Email: {{ user[2] }}</p>
        </div>
    </div>

    <div> <!-- Following Categories/Posts Section -->
        <h2>Following and Saved</h2>

        <div> <!-- Following Categories -->
            <h3>Following Categories</h3>
            {% for category in categories[0] %}
            <div> <!-- Make the background for each category card the category photo -->
                <a href='{{ url_for('get_category', cat_id=category)}}'><h4>{{ categories[1][loop.index0] }}</h4></a>
            </div>
            {% endfor %}
        </div>

        <div>
            <h3>Saved Posts</h3>
            {% for post in saved_posts %}
                <div id="post_prev"> <!--Post Preview-->
                    <div id="post_image"> <!--Post Image-->
                        <img src="{{ post.image }}" alt="Post Image"> <!--TODO: All images TT-->
                    </div>
                    <a href="{{url_for('get_category', cat_id=post[5])}}">{{ post[6] }}</a> <!--Post Category-->
                     <a href="{{url_for('get_post', post_id=post[0])}}"><h4>{{ post[3] }}</h4></a><!--Post Title-->
                    <p>Posted by <a href="{{ url_for('get_profile',user_id=post[7])}}">{{ post[8] }}</a> on {{ post[1] }}</p>
                    <p>{{ post[2] }} comments</p>
                </div>
            {% endfor %}
        </div>
    
        <div>
            <h3>Following Users</h3>
            {% for user in following_u %}
            <div class="profile_card">
                {% if user[2] != None %}
                    <img src="/uploads/{{ user[2] }}" alt="profile picture of {{ user[1] }}">
                {% else %}
                    <img src="/default_pfp.png" alt="Default Profile Picutre">
                {% endif %}
                <a href='{{ url_for('get_profile', user_id=user[0])}}'><h4>{{ user[1] }}</h4></a>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <div> <!-- Posts by user -->
        <h3>Posts by {{ user[1] }}</h3>
        {% if posts | length == 0 %}
            <p>No posts yet</p>
        {% endif %}
        {% for post in posts %}
                <div id="post_prev"> <!--Post Preview-->
                    <div id="post_image"> <!--Post Image-->
                        <img src="{{ post.image }}" alt="Post Image">
                    </div>
                    <a href="{{url_for('get_category', cat_id=post[5])}}">{{ post[6] }}</a> <!--Post Category-->
                     <a href="{{url_for('get_post', post_id=post[0])}}"><h4>{{ post[3] }}</h4></a><!--Post Title-->
                    <p>Posted by <a href="{{ url_for('get_profile',user_id=post[7])}}">{{ post[8] }}</a> on {{ post[1] }}</p>  <!--Meant to be author-->
                    <p>{{ post[2] }} comments</p>
                </div>
            {% endfor %}
    </div>
{% endblock %}